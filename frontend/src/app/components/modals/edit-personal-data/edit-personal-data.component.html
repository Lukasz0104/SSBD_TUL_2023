<ng-container
    *ngIf="ownAccount$ | async as ownAccount; else loadingAccountData">
    <div class="modal-header">
        <h2
            class="modal-title"
            id="modal-basic-title">
            Edit your account
        </h2>
    </div>
    <div class="modal-body px-4 py-2">
        <div>
            <div class="row">
                <div class="col-md">
                    <form [formGroup]="editPersonalDataForm">
                        <h2>General</h2>
                        <p><strong>Personal data</strong></p>
                        <div class="mb-2 has-validation">
                            <label
                                class="form-label"
                                for="firstName"
                                >First name</label
                            >
                            <input
                                class="form-control"
                                formControlName="firstName"
                                id="firstName"
                                type="text"
                                [ngClass]="{
                                    'is-invalid': firstNameControl.invalid,
                                    'is-valid': firstNameControl.valid
                                }" />
                            <div
                                *ngIf="firstNameControl.errors"
                                class="invalid-feedback">
                                <p
                                    *ngIf="firstNameControl.errors['required']"
                                    class="mb-0">
                                    First name is required.
                                </p>
                                <p
                                    *ngIf="firstNameControl.errors['minlength']"
                                    class="mb-0">
                                    First name must be at least 1 character
                                    long.
                                </p>
                                <p
                                    *ngIf="firstNameControl.errors['maxlength']"
                                    class="mb-0">
                                    First name must be at most 100 character
                                    long.
                                </p>
                            </div>
                        </div>
                        <div class="mb-2 has-validation">
                            <label
                                class="form-label"
                                for="lastName"
                                >Last name</label
                            >
                            <input
                                class="form-control"
                                formControlName="lastName"
                                id="lastName"
                                type="text"
                                [ngClass]="{
                                    'is-invalid': lastNameControl.invalid,
                                    'is-valid': lastNameControl.valid
                                }" />
                            <div
                                *ngIf="lastNameControl.errors"
                                class="invalid-feedback">
                                <p
                                    *ngIf="lastNameControl.errors['required']"
                                    class="mb-0">
                                    Last name is required.
                                </p>
                                <p
                                    *ngIf="lastNameControl.errors['minlength']"
                                    class="mb-0">
                                    Last name must be at least 1 character long.
                                </p>
                                <p
                                    *ngIf="lastNameControl.errors['maxlength']"
                                    class="mb-0">
                                    Last name must be at most 100 character
                                    long.
                                </p>
                            </div>
                        </div>
                    </form>
                </div>
                <ng-container
                    *ngFor="let accessLevel of ownAccount.accessLevels">
                    <div
                        class="col-md"
                        *ngIf="accessLevel.level === AccessType.OWNER">
                        <hr class="d-md-none border-top border-5 border-dark" />
                        <h2>{{ accessLevel.level | titlecase }}</h2>
                        <form [formGroup]="editOwnerDataForm">
                            <div *ngIf="accessLevel.address as address">
                                <p><strong>Address</strong></p>
                                <div class="mb-2 has-validation">
                                    <label
                                        class="form-label"
                                        for="street"
                                        >Street</label
                                    >
                                    <input
                                        class="form-control"
                                        formControlName="street"
                                        type="text"
                                        [ngClass]="{
                                            'is-invalid':
                                                ownerStreetControl.invalid,
                                            'is-valid': ownerStreetControl.valid
                                        }" />
                                    <div
                                        *ngIf="ownerStreetControl.errors"
                                        class="invalid-feedback">
                                        <p
                                            *ngIf="
                                                ownerStreetControl.errors[
                                                    'required'
                                                ]
                                            "
                                            class="mb-0">
                                            Street is required.
                                        </p>
                                        <p
                                            *ngIf="
                                                ownerStreetControl.errors[
                                                    'maxlength'
                                                ]
                                            "
                                            class="mb-0">
                                            Street must be at most 85 character
                                            long.
                                        </p>
                                    </div>
                                </div>
                                <div class="mb-2 has-validation">
                                    <label
                                        class="form-label"
                                        for="buildingNumber"
                                        >Building number</label
                                    >
                                    <input
                                        class="form-control"
                                        formControlName="buildingNumber"
                                        type="text"
                                        [ngClass]="{
                                            'is-invalid':
                                                ownerBuldingNumberControl.invalid,
                                            'is-valid':
                                                ownerBuldingNumberControl.valid
                                        }" />
                                    <div
                                        *ngIf="ownerBuldingNumberControl.errors"
                                        class="invalid-feedback">
                                        <p
                                            *ngIf="
                                                ownerBuldingNumberControl
                                                    .errors['required']
                                            "
                                            class="mb-0">
                                            Building number is required.
                                        </p>
                                        <p
                                            *ngIf="
                                                ownerBuldingNumberControl
                                                    .errors['min']
                                            "
                                            class="mb-0">
                                            Building number must be greater than
                                            0.
                                        </p>
                                    </div>
                                </div>
                                <div class="mb-2 has-validation">
                                    <label
                                        class="form-label"
                                        for="postalCode"
                                        >Postal code</label
                                    >
                                    <input
                                        class="form-control"
                                        formControlName="postalCode"
                                        type="text"
                                        [ngClass]="{
                                            'is-invalid':
                                                ownerPostalCodeControl.invalid,
                                            'is-valid':
                                                ownerPostalCodeControl.valid
                                        }" />
                                    <div
                                        *ngIf="ownerPostalCodeControl.errors"
                                        class="invalid-feedback">
                                        <p
                                            *ngIf="
                                                ownerPostalCodeControl.errors[
                                                    'required'
                                                ]
                                            "
                                            class="mb-0">
                                            Postal code is required.
                                        </p>
                                        <p
                                            *ngIf="
                                                ownerPostalCodeControl.errors[
                                                    'maxlength'
                                                ] ||
                                                ownerPostalCodeControl.errors[
                                                    'minlength'
                                                ]
                                            "
                                            class="mb-0">
                                            Postal code must be 6 character
                                            long.
                                        </p>
                                    </div>
                                </div>
                                <div class="mb-2 has-validation">
                                    <label
                                        class="form-label"
                                        for="city"
                                        >City</label
                                    >
                                    <input
                                        class="form-control"
                                        formControlName="city"
                                        type="text"
                                        [ngClass]="{
                                            'is-invalid':
                                                ownerCityControl.invalid,
                                            'is-valid': ownerCityControl.valid
                                        }" />
                                    <div
                                        *ngIf="ownerCityControl.errors"
                                        class="invalid-feedback">
                                        <p
                                            *ngIf="
                                                ownerCityControl.errors[
                                                    'required'
                                                ]
                                            "
                                            class="mb-0">
                                            City is required.
                                        </p>
                                        <p
                                            *ngIf="
                                                ownerCityControl.errors[
                                                    'minlength'
                                                ]
                                            "
                                            class="mb-0">
                                            City must be at least 2 character
                                            long.
                                        </p>
                                        <p
                                            *ngIf="
                                                ownerCityControl.errors[
                                                    'maxlength'
                                                ]
                                            "
                                            class="mb-0">
                                            City must be at most 85 character
                                            long.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div
                        class="col-md"
                        *ngIf="accessLevel.level === AccessType.MANAGER">
                        <hr class="d-md-none border-top border-5 border-dark" />
                        <h2>{{ accessLevel.level | titlecase }}</h2>
                        <form [formGroup]="editManagerDataForm">
                            <div *ngIf="accessLevel.address as address">
                                <p><strong>Address</strong></p>

                                <div class="mb-2 has-validation">
                                    <label
                                        class="form-label"
                                        for="street"
                                        >Street</label
                                    >
                                    <input
                                        class="form-control"
                                        formControlName="street"
                                        id="street"
                                        type="text"
                                        [ngClass]="{
                                            'is-invalid':
                                                managerStreetControl.invalid,
                                            'is-valid':
                                                managerStreetControl.valid
                                        }" />
                                    <div
                                        *ngIf="managerStreetControl.errors"
                                        class="invalid-feedback">
                                        <p
                                            *ngIf="
                                                managerStreetControl.errors[
                                                    'required'
                                                ]
                                            "
                                            class="mb-0">
                                            Street is required.
                                        </p>
                                        <p
                                            *ngIf="
                                                managerStreetControl.errors[
                                                    'maxlength'
                                                ]
                                            "
                                            class="mb-0">
                                            Street must be at most 85 character
                                            long.
                                        </p>
                                    </div>
                                </div>
                                <div class="mb-2 has-validation">
                                    <label
                                        class="form-label"
                                        for="buildingNumber"
                                        >Building number</label
                                    >
                                    <input
                                        class="form-control"
                                        formControlName="buildingNumber"
                                        id="buildingNumber"
                                        type="text"
                                        [ngClass]="{
                                            'is-invalid':
                                                managerBuldingNumberControl.invalid,
                                            'is-valid':
                                                managerBuldingNumberControl.valid
                                        }" />
                                    <div
                                        *ngIf="
                                            managerBuldingNumberControl.errors
                                        "
                                        class="invalid-feedback">
                                        <p
                                            *ngIf="
                                                managerBuldingNumberControl
                                                    .errors['required']
                                            "
                                            class="mb-0">
                                            Building number is required.
                                        </p>
                                        <p
                                            *ngIf="
                                                managerBuldingNumberControl
                                                    .errors['min']
                                            "
                                            class="mb-0">
                                            Building number must be greater than
                                            0.
                                        </p>
                                    </div>
                                </div>
                                <div class="mb-2 has-validation">
                                    <label
                                        class="form-label"
                                        for="postalCode"
                                        >Postal code</label
                                    >
                                    <input
                                        class="form-control"
                                        formControlName="postalCode"
                                        id="postalCode"
                                        type="text"
                                        [ngClass]="{
                                            'is-invalid':
                                                managerPostalCodeControl.invalid,
                                            'is-valid':
                                                managerPostalCodeControl.valid
                                        }" />
                                    <div
                                        *ngIf="managerPostalCodeControl.errors"
                                        class="invalid-feedback">
                                        <p
                                            *ngIf="
                                                managerPostalCodeControl.errors[
                                                    'required'
                                                ]
                                            "
                                            class="mb-0">
                                            Postal code is required.
                                        </p>
                                        <p
                                            *ngIf="
                                                managerPostalCodeControl.errors[
                                                    'maxlength'
                                                ] ||
                                                managerPostalCodeControl.errors[
                                                    'minlength'
                                                ]
                                            "
                                            class="mb-0">
                                            Postal code must be 6 character
                                            long.
                                        </p>
                                    </div>
                                </div>
                                <div class="mb-2 has-validation">
                                    <label
                                        class="form-label"
                                        for="city"
                                        >City</label
                                    >
                                    <input
                                        class="form-control"
                                        formControlName="city"
                                        id="city"
                                        type="text"
                                        [ngClass]="{
                                            'is-invalid':
                                                managerCityControl.invalid,
                                            'is-valid': managerCityControl.valid
                                        }" />
                                    <div
                                        *ngIf="managerCityControl.errors"
                                        class="invalid-feedback">
                                        <p
                                            *ngIf="
                                                managerCityControl.errors[
                                                    'required'
                                                ]
                                            "
                                            class="mb-0">
                                            City is required.
                                        </p>
                                        <p
                                            *ngIf="
                                                managerCityControl.errors[
                                                    'minlength'
                                                ]
                                            "
                                            class="mb-0">
                                            City must be at least 2 character
                                            long.
                                        </p>
                                        <p
                                            *ngIf="
                                                managerCityControl.errors[
                                                    'maxlength'
                                                ]
                                            "
                                            class="mb-0">
                                            City must be at most 85 character
                                            long.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div *ngIf="accessLevel.licenseNumber">
                                <div class="mb-2 has-validation">
                                    <label
                                        class="form-label"
                                        for="licenseNumber"
                                        ><strong>License number</strong></label
                                    >
                                    <input
                                        class="form-control"
                                        formControlName="licenseNumber"
                                        id="licenseNumber"
                                        type="text"
                                        [ngClass]="{
                                            'is-invalid':
                                                managerLicenseNumberControl.invalid,
                                            'is-valid':
                                                managerLicenseNumberControl.valid
                                        }" />
                                    <div
                                        *ngIf="
                                            managerLicenseNumberControl.errors
                                        "
                                        class="invalid-feedback">
                                        <p
                                            *ngIf="
                                                managerLicenseNumberControl
                                                    .errors['required']
                                            "
                                            class="mb-0">
                                            License number is required.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </ng-container>
            </div>
        </div>
    </div>
    <div class="px-4 d-flex justify-content-between modal-footer">
        <div
            (click)="activeModal.close(false)"
            class="btn btn-outline-secondary">
            Cancel
        </div>
        <button
            [disabled]="!areAllValid()"
            (click)="onSubmit()"
            class="btn btn-success">
            Save
        </button>
    </div>
</ng-container>
<ng-template #loadingAccountData>
    <div class="d-flex flex-column justify-content-center align-items-center">
        <span class="spinner-border"></span>
        <span class="mt-3">Loading account data...</span>
    </div>
</ng-template>
